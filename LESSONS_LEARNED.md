# 经验教训总结

本文档记录项目中的重要经验教训，避免重复犯错。

---

## ❌ 失败案例 1: YAMNet迁移学习（2025-12-20）

### 实验背景
- **目标**: 使用预训练模型提升准确率（期望75-85%）
- **实际结果**: 54.93%（比baseline差2.93%）
- **耗时**: 约8小时（研究+实现+调试+训练）

### 为什么失败？

#### 1. 领域不匹配 🎯
```
YAMNet预训练数据集: AudioSet
- 音乐、语音、环境音、动物叫声等
- 通用音频分类任务

目标任务: 食物咀嚼声分类
- 非常特定的生物声学信号
- 微妙的纹理和频率差异
```

**教训**: 预训练模型的来源领域与目标任务领域差异过大时，不如简单的针对性模型。

#### 2. 特征不适配 🔧
- YAMNet输出1024维通用embedding
- 这些特征对音乐/语音有效，但对咀嚼声的discriminative power不足
- 全局平均池化丢失了重要的时序纹理信息

**教训**: 特征工程要考虑任务特性，通用特征≠最优特征。

#### 3. 技术债务 💻
- 使用`tf.map_fn`处理batch导致效率低下
- TensorFlow Hub兼容性问题（keras vs tf.keras）
- Unicode编码问题（Windows终端）
- JSON序列化numpy类型错误

**教训**: 引入新库要充分评估兼容性成本，有时"reinvent the wheel"反而更快。

### 成本分析

| 项目 | 时间 | 价值 |
|------|------|------|
| 研究预训练模型 | 2小时 | ✓ 了解了迁移学习局限性 |
| 实现YAMNet集成 | 3小时 | ✗ 最终未使用 |
| 调试兼容性问题 | 2小时 | ✗ 纯粹浪费时间 |
| 训练实验 | 1小时 | ✓ 验证了假设 |
| **总计** | **8小时** | **净收益: 负** |

### 应该怎么做？

#### ✓ 正确的做法：
1. **先做小规模验证**
   - 用train_sample快速测试（10分钟）
   - 如果sample数据就不行，full数据也不会好
   - EXP007已经显示40.5% < 57.86%，应立即停止

2. **领域适配性评估**
   - AudioSet与食物声音相似度分析
   - 查找专门的音频事件检测预训练模型
   - 或直接放弃预训练，专注baseline优化

3. **ROI计算**
   - 预期提升: 15-25% → 实际: -3%
   - 实现成本: 8小时
   - 如果小样本测试不理想，立即pivot

---

## ✅ 成功案例参考: Baseline优化（2025-12-20）

### 什么有效？

1. **简化架构** 
   - 4层CNN（7%过拟合）→ 3层CNN（57.86%）
   - 教训: 复杂≠更好

2. **实验管理系统**
   - 自动归档所有实验结果
   - 便于对比和论文撰写
   - 投入2小时，长期受益

3. **迭代速度**
   - Sample数据快速验证（20分钟）
   - 发现问题立即调整
   - Full数据最终验证（85分钟）

---

## 🎯 未来原则

### 1. 快速失败原则
```
实验前评估:
- 预期提升 > 10%？
- 实现成本 < 4小时？
- 有快速验证方法？

如果任一答案为否，重新考虑
```

### 2. 小步迭代原则
```
不要一次改变太多:
❌ 同时换模型 + 换输入 + 换loss
✓ 每次只改一个变量
✓ 用sample数据快速验证
```

### 3. 领域匹配原则
```
使用预训练模型前问:
- 预训练数据与目标任务的overlap？
- 是否有更匹配领域的模型？
- Baseline vs 预训练的trade-off？
```

### 4. 技术债务原则
```
引入新技术/库前评估:
- 兼容性风险？
- 学习曲线？
- 维护成本？

如果不确定，先做PoC
```

---

## 📊 决策树：要不要尝试新方法？

```
新方法想法
    ↓
[Q1] 理论上能提升>10%？
    ↓ 否 → ❌ 放弃
    ↓ 是
[Q2] 能用sample数据快速验证(<30分钟)？
    ↓ 否 → 🤔 重新设计实验
    ↓ 是
[Q3] 实现成本<4小时？
    ↓ 否 → 🤔 评估ROI
    ↓ 是
    ↓
✓ 开始实验
    ↓
[Sample结果]
    ↓
提升>5%？
    ↓ 否 → ❌ 立即停止
    ↓ 是
    ↓
✓ 继续完整训练
```

---

## 💡 当前最佳策略

基于EXP-003 baseline (57.86%)，优先级排序：

### 1. 数据增强 ⭐⭐⭐⭐⭐
- **预期提升**: 10-15%
- **实现成本**: 2小时
- **风险**: 低
- **理由**: 样本少的类别表现差，急需augmentation

### 2. 架构优化 ⭐⭐⭐⭐
- **预期提升**: 5-10%
- **实现成本**: 3小时
- **风险**: 中（可能过拟合）
- **理由**: 当前模型可能容量不足

### 3. 多特征融合 ⭐⭐⭐
- **预期提升**: 5-8%
- **实现成本**: 4小时
- **风险**: 中
- **理由**: Mel谱可能信息不全

### ❌ 不再考虑
- ~~YAMNet等通用预训练模型~~（已验证失败）
- ~~复杂的Transformer架构~~（数据量不足）
- ~~大规模超参数搜索~~（ROI太低）

---

## 📝 实验Checklist

每次实验前检查：

- [ ] 明确的假设（为什么这个方法会更好？）
- [ ] 量化的预期（具体提升多少？）
- [ ] 快速验证方案（sample数据测试）
- [ ] 失败退出条件（什么情况下停止？）
- [ ] 时间预算（最多花多少时间？）
- [ ] 记录实验配置（便于复现）
- [ ] 保存所有结果（便于对比）

**记住**: 快速失败优于完美实现！

---

*更新日期: 2025-12-21*
