# 项目使用指南

## 🎯 项目目标

通过机器学习识别音频中的食用声音，判断正在食用的食物类型。

## 📋 完整工作流程

### 阶段一：快速验证

**目的**：小数据集快速验证代码是否正常工作

1. **确认配置**

   ```python
   # 打开 config.py，确认：
   USE_SAMPLE_DATA = True  # 使用样本数据
   EPOCHS = 50             # 训练轮数
   ```
2. **运行训练**

   ```bash
   python train.py
   ```

   训练时间：几分钟到十几分钟

   输出：训练进度、准确率、损失值

   保存：最佳模型到 `models/cnn_sample_best.h5`
3. **运行预测**

   ```bash
   python predict.py
   ```

   输出：test_a 和 test_b 的预测结果

   保存：CSV文件到 `submissions/` 目录
4. **检查结果**

   查看 `submissions/` 目录下的 CSV 文件

   格式要求：第一列为文件名(name)，第二列为类别(label)

### 阶段二：正式训练

**目的**：使用完整数据集训练高性能模型

1. **修改配置**

   ```python
   # 打开 config.py，修改：
   USE_SAMPLE_DATA = False  # 使用完整训练集
   EPOCHS = 100             # 可以增加训练轮数
   ```
2. **运行完整训练**

   ```bash
   python train.py
   ```

   保存：`models/cnn_full_best.h5`
3. **生成最终预测**

   ```bash
   python predict.py
   ```
4. **提交结果**

   - 选择 `submissions/` 目录下时间戳最新的文件
   - 提交 `submission_test_a_*.csv` 和 `submission_test_b_*.csv`

## 📊 关键文件说明

### 1. config.py - 配置中心

```python
# 最重要的开关
USE_SAMPLE_DATA = True/False  # 选择训练数据集

# 模型参数（可调整优化性能）
BATCH_SIZE = 32      # 批次大小
EPOCHS = 50          # 训练轮数
LEARNING_RATE = 0.001  # 学习率
```

### 2. train.py - 训练脚本

- 自动加载配置
- 加载并处理数据
- 构建和训练模型
- 保存最佳模型
- 生成训练曲线图

### 3. predict.py - 预测脚本

- 加载训练好的模型
- 处理测试集音频
- 生成预测结果
- 保存为CSV格式

### 4. data_preprocessing.py - 数据处理

- 音频加载和预处理
- Mel频谱图特征提取
- 数据标准化

### 5. model.py - 模型定义

- CNN模型架构
- ResNet-like模型（可选）
- 优化器和损失函数配置

## 🔧 参数调优建议

### 快速迭代（调试阶段）

```python
USE_SAMPLE_DATA = True
EPOCHS = 20
BATCH_SIZE = 32
```

### 中等训练（初步验证）

```python
USE_SAMPLE_DATA = True
EPOCHS = 50
BATCH_SIZE = 32
```

### 完整训练（最终提交）

```python
USE_SAMPLE_DATA = False
EPOCHS = 100
BATCH_SIZE = 32  # 如果内存不足，减小到16
```

## 📈 性能监控

### 训练过程中关注指标

- `accuracy`: 训练准确率
- `val_accuracy`: 验证准确率（更重要）
- `loss`: 训练损失
- `val_loss`: 验证损失

### 理想情况

- 验证准确率持续提升
- 验证损失持续下降
- 训练和验证曲线趋势一致

### 过拟合警告

- 训练准确率很高，验证准确率低
- 训练损失很低，验证损失高

解决方法：

- 增加Dropout比例
- 减少训练轮数
- 增加训练数据

## 🎓 学习成果展示

### 最终报告可包含内容

1. **问题定义**

   - 音频食物分类任务
   - 20个食物类别
   - 数据集规模
2. **方法论**

   - 音频特征提取（Mel频谱图）
   - CNN模型架构
   - 训练策略
3. **实验结果**

   - 训练曲线图（自动生成）
   - 验证准确率
   - 混淆矩阵（可选扩展）
4. **创新点**

   - 数据增强技术
   - 模型架构优化
   - 超参数调优
5. **源代码**

   - 所有.py文件
   - README.md
   - requirements.txt

## 🐛 常见问题排查

### 问题1：ImportError

```bash
# 解决：安装缺失的库
pip install <缺失的库名>
```

### 问题2：找不到训练数据

```
检查：
- train/ 或 train_sample/ 目录是否存在
- 是否包含20个子文件夹
- 每个文件夹是否有.wav文件
```

### 问题3：模型训练不收敛

```
调整：
- 减小学习率：LEARNING_RATE = 0.0001
- 增加训练轮数：EPOCHS = 100
- 检查数据是否正确加载
```

### 问题4：内存不足

```
调整：
- 减小批次大小：BATCH_SIZE = 16 或 8
- 使用样本数据：USE_SAMPLE_DATA = True
```

### 问题5：预测时找不到模型

```
检查：
- models/ 目录下是否有 .h5 文件
- 确认已运行过 train.py
- 查看模型文件名是否匹配
```

## 🚀 高级扩展（可选）

### 1. 尝试不同模型

```python
# 在 train.py 末尾取消注释
model_resnet, history_resnet = train_model(model_type='resnet', epochs=EPOCHS)
```

### 2. 数据增强

```python
# 在 config.py 中启用
USE_DATA_AUGMENTATION = True
AUGMENTATION_FACTOR = 3
```

### 3. 集成学习

- 训练多个模型
- 对预测结果进行投票或平均

### 4. 可视化分析

- 绘制混淆矩阵
- 分析错误分类样本
- 可视化音频特征

## 📞 支持

如有问题，检查以下资源：

1. README.md - 项目概览
2. 本文件 - 详细使用指南
3. 各个.py文件顶部的文档字符串

祝你的项目顺利完成！🎉
